<!DOCTYPE html>
<html lang="et" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="common :: common_header(~{::title},~{::links})">
<title th:text="#{term.search.title}">EKILEX otsing</title>
<th:block th:fragment="links">
  <script type="text/javascript" th:src="@{/view/js/ekilex-editor.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-searchfilter.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-termsearch.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-termdialog.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-dialog.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-sourcesearch.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/bootstrap-datepicker.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/bootstrap-datepicker.et.min.js}"></script>
  <link rel="stylesheet" th:href="@{/view/css/bootstrap-datepicker3.css}"/>
</th:block>
</head>
<body class="body-with-navbar compacted">

  <th:block th:replace="common :: nav_bar(activeItem = 'term')"></th:block>

  <div class="container-fluid">
    <div class="card shadow">
      <div class="card-body p-2">
        <form id="searchForm" th:action="@{/termsearch}" method="post">
          <th:block th:replace="search :: search_form('term_search', true)"></th:block>
          <div class="form-row pt-2 align-items-center">
            <div class="col-auto">
              <div class="row align-items-center">
                <label class="col-auto col-form-label">Tulemused:</label>
                <div class="col-auto">
                  <select id="resultLang" name="resultLang" class="form-control">
                    <option value="">Kõik keeled</option>
                    <option
                        th:each="lang : ${allLanguages}"
                        th:value="${lang.code}"
                        th:selected="${lang.code == sessionBean.resultLang}"
                        th:text="${lang.value}"></option>
                  </select>
                </div>
                <div class="col-auto">
                  <label class="switch mb-0" title="Näita mõiste muid termineid">
                    <input id="meaning-other-words-visible-check" type="checkbox" checked="checked"/>
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
            </div>
            <div class="col-1">
              &nbsp;
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="mt-4 float-left" th:if="${noResults}">
      <div th:text="#{term.not.found}">Not found.</div>
    </div>
    <div class="mt-4 float-left" th:if="${invalidSearch}">
      <div th:text="#{term.search.invalid}"></div>
    </div>

    <div class="row no-gutters mt-2">
      <div class="col-3 pr-2 pb-2" style="height: calc(100vh - 14rem); overflow-y: auto;">
        <div id="results_div" class="card shadow" th:if="${meaningsResult.resultExist}">
          <div th:replace="termcomp :: search_result"></div>
        </div>
      </div>
      <div class="col-9" style="height: calc(100vh - 14rem); overflow-y: auto; overflow-x: hidden;">
        <div id="details_div"></div>
      </div>
    </div>
  </div>

  <th:block th:fragment="details" th:if="${meaning != null}">
    <div th:data-id="${meaningId}" id="details_div"
         th:with="isMeaningCrudGranted=${#authorization.expression('hasPermission(#vars.meaningId, ''MEANING'', ''DATASET:CRUD'')')}">

        <div th:replace="termdialog :: add_meaning_data_dlg"></div>
        <div th:replace="termdialog :: add_meaning_domain_dlg"></div>
        <div th:replace="termdialog :: add_definition_dlg"></div>
        <div th:replace="termdialog :: add_learner_comment_dlg"></div>
        <div th:replace="termdialog :: add_meaning_public_note_dlg"></div>
        <div th:replace="termdialog :: add_meaning_process_log_dlg"></div>
        <div th:replace="termdialog :: add_meaning_relation_dlg"></div>

      <button id="refresh-details" hidden="hidden" th:data-id="${meaningId}" name="detailsBtn" data-refresh></button>
      <div class="card mb-2 shadow" style="border-style: dotted; border-width: 4px; border-color: #aaa">
        <div class="card-body">
          <div class="row">
            <div class="col">
              <b th:text="${meaningId}"></b>
            </div>
            <div class="col-auto form-inline">
              <button type="button" class="btn badge badge-success position-right"
                      title="Lisa andmeid"
                      data-toggle="modal"
                      th:data-target="${'#addMeaningDataDlg_' + meaningId}"
                      sec:authorize="${#vars.isMeaningCrudGranted}">
                <i class="fa fa-plus" aria-hidden="true"></i>
              </button>
            </div>
            <div class="col-auto ml-auto">
              <a class="btn btn-primary btn-sm"
                 th:href="@{'/meaningjoin/' + ${meaningId}}"
                 title="Tähenduste ühendamine"
                 sec:authorize="${#vars.isMeaningCrudGranted}">Ühenda</a>
              <button id="duplicateMeaningBtn"
                      title="Tee duplikaat mõistest ja kõigist tema ilmikutest"
                      class="btn btn-primary btn-sm"
                      th:data-meaning-id="${meaningId}"
                      sec:authorize="${#vars.isMeaningCrudGranted}">Duplikaat</button>
              <button class="btn btn-primary btn-sm"
                      data-toggle="modal"
                      data-target="#newWordDlg"
                      th:data-meaning-id="${meaningId}"
                      sec:authorize="#vars.permDataUtil.isRoleSelected(#vars.sessionBean)">Uus termin</button>
              <button class="btn btn-warning font-weight-bold btn-sm" type="button"
                      th:data-id="${meaningId}"
                      data-callback="doNewSearch"
                      data-toggle="deleteMeaningAndLexemesAndWords"
                      sec:authorize="#vars.permDataUtil.isLexemeDeleteGrantedForMeaning(#vars.meaningId, #vars.sessionBean)">Kustuta</button>
              <a th:href="@{'/meaninglifecyclelog:' + ${meaningId}}"
                 data-toggle="modal"
                 data-target="#meaningLifecycleLogDlg"
                 class="btn btn-secondary btn-sm  ml-4"
                 sec:authorize="${#vars.isMeaningCrudGranted}">Tegevuste logi</a>
              <a th:href="@{'/meaningprocesslog:' + ${meaningId}}"
                 data-toggle="modal"
                 data-target="#processLogDlg"
                 class="btn btn-secondary btn-sm"
                 sec:authorize="${#vars.isMeaningCrudGranted}">Menetluse logi</a>
              <button type="button" class="btn badge badge-secondary"
                      title="Lisa kirje menetluse logisse"
                      data-toggle="modal"
                      th:data-target="${'#addMeaningProcessLogDlg_' + meaningId}"
                      sec:authorize="${#vars.isMeaningCrudGranted}">
                <i class="fa fa-plus-circle" aria-hidden="true"></i>
              </button>
            </div>
          </div>
          <div th:replace="termcomp :: meaning_domain"></div>
          <div class="row">
            <div class="col pr-0 col-w13rem">
              <span class="lbl">Seletused</span>
              <button type="button" class="btn badge badge-success" title="Lisa uus"
                      data-toggle="modal"
                      th:data-target="${'#addDefinitionDlg_' + meaningId}"
                      sec:authorize="#vars.permDataUtil.isRoleSelected(#vars.sessionBean)">
                <i class="fa fa-plus" aria-hidden="true"></i>
              </button>
            </div>
            <div class="col pl-0">
              <th:block th:each="definitionLangGroup : ${meaning.definitionLangGroups}">
                <div>
                  <span th:text="${iso2languages[definitionLangGroup.lang]}" class="mr-2"></span>
                  <button name="lang-collapse-btn" type="button" class="btn badge badge-secondary btn-toggle"
                          th:data-lang="${definitionLangGroup.lang}"
                          th:title="${definitionLangGroup.selected ? 'Peida keele grupp' : 'Näita keele grupp'}">
                    <i th:class="${definitionLangGroup.selected ? 'fa fa-angle-down' : 'fa fa-angle-right'}" aria-hidden="true"></i>
                  </button>
                </div>
                <div th:if="${definitionLangGroup.selected}" class="orderable" data-op-code="definition">
                  <div class="ml-4" style="position: relative"
                       th:each="definition, itemIter: ${definitionLangGroup.definitions}"
                       th:with="isDefinitionCrudGranted=${#authorization.expression('hasPermission(#vars.definition.id, ''DEFINITION'', ''DATASET:CRUD'')')}"
                       th:data-id="${definition.id}"
                       th:data-orderby="${definition.orderBy}">
                    <div th:replace="termdialog :: edit_definition_dlg"></div>
                    <div th:replace="termdialog :: add_definition_source_link_dlg"></div>
                    <div th:replace="termdialog :: add_definition_public_note_dlg"></div>
                    <div style="display: list-item; position: absolute"></div>
                    <div class="action-column">
                      <th:block th:replace="common :: ordering_buttons(${itemIter})" sec:authorize="${#vars.isMeaningCrudGranted}"></th:block>
                    </div>
                    <div class="invisible-buttons action-buttons-anchor  mw-90">
                      <span th:utext="${definition.value}"></span>
                      <span class="font-italic text-info" th:text="${definition.typeValue}"></span>
                      <span th:if="${#lists.isEmpty(definition.sourceLinks)}" class="show-on-mouseover">
                        [
                        <button type="button" class="btn badge badge-success"
                                title="Lisa allikaviide"
                                data-toggle="modal"
                                th:data-target="${'#addDefinitionSourceLinkDlg_' + definition.id}"
                                sec:authorize="${#vars.isDefinitionCrudGranted}">
                          <i class="fa fa-external-link" aria-hidden="true"></i>
                        </button>
                        ]
                      </span>
                      <div class="action-buttons-3">
                        <button type="button" class="btn badge badge-primary"
                                title="Muuda"
                                data-toggle="modal"
                                th:data-target="${'#editDefinitionDlg_' + definition.id}"
                                sec:authorize="${#vars.isDefinitionCrudGranted}">
                          <i class="fa fa-edit" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn badge badge-success"
                                title="Lisa märkus"
                                data-toggle="modal"
                                th:data-target="${'#addDefinitionPublicNoteDlg_' + definition.id}"
                                sec:authorize="${#vars.isDefinitionCrudGranted}">
                          <i class="fa fa-sticky-note-o" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn badge badge-warning"
                                data-op-code="definition"
                                th:data-id="${definition.id}"
                                data-toggle="delete-confirm"
                                data-placement="right"
                                sec:authorize="${#vars.isDefinitionCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                    <div class="hidden-buttons">
                      <span th:each="sourceLink : ${definition.sourceLinks}" th:if="${not #lists.isEmpty(definition.sourceLinks)}">
                        [
                        <a th:href="@{'/def_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                        <span th:if="${sourceLink.name != null}" th:text="${sourceLink.name}"></span>
                        <button type="button" class="btn badge badge-warning"
                                data-op-code="def_source_link"
                                th:data-id="${sourceLink.id}"
                                data-toggle="delete-confirm"
                                data-placement="right"
                                sec:authorize="${#vars.isDefinitionCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                        ]
                      </span>
                      <button type="button" class="btn badge badge-success"
                              title="Lisa allikaviide"
                              data-toggle="modal"
                              th:data-target="${'#addDefinitionSourceLinkDlg_' + definition.id}"
                              sec:authorize="${#vars.isDefinitionCrudGranted}">
                        <i class="fa fa-external-link" aria-hidden="true"></i>
                      </button>
                    </div>
                    <div th:if="${not #lists.isEmpty(definition.publicNotes)}" class="col pl-0">
                      <div>
                        <span class="lbl">Märkused</span>
                      </div>
                      <th:block th:each="publicNote : ${definition.publicNotes}">
                        <div th:replace="termdialog :: edit_definition_public_note_dlg"></div>
                        <div th:replace="termdialog :: add_definition_public_note_source_link_dlg"></div>
                        <div class="small invisible-buttons action-buttons-anchor mw-90 ml-4">
                          <div style="display: list-item; position: absolute"></div>
                          <span th:utext="${publicNote.valuePrese}"></span>
                          <span class="show-on-mouseover" th:if="${#lists.isEmpty(publicNote.sourceLinks)}">
                            [
                            <button type="button" class="btn badge badge-success"
                                    title="Lisa allikaviide"
                                    data-toggle="modal"
                                    th:data-target="${'#addDefinitionPublicNoteSourceLinkDlg_' + definition.id + '_' + publicNote.id}"
                                    sec:authorize="${#vars.isDefinitionCrudGranted}">
                              <i class="fa fa-external-link" aria-hidden="true"></i>
                            </button>
                            ]
                          </span>
                          <div class="action-buttons-2">
                            <button type="button" class="btn badge badge-primary"
                                    th:title="Muuda"
                                    data-toggle="modal"
                                    th:data-target="${'#editDefinitionPublicNoteDlg_' + definition.id + '_' + publicNote.id}"
                                    sec:authorize="${#vars.isDefinitionCrudGranted}">
                              <i class="fa fa-edit" aria-hidden="true"></i>
                            </button>
                            <button type="button" class="btn badge badge-warning"
                                    th:data-id="${publicNote.id}"
                                    data-op-code="definition_public_note"
                                    data-toggle="delete-confirm"
                                    data-placement="right"
                                    sec:authorize="${#vars.isDefinitionCrudGranted}">
                              <i class="fa fa-remove" aria-hidden="true"></i>
                            </button>
                          </div>
                        </div>
                        <div class="small hidden-buttons ml-4">
                          <span th:each="sourceLink : ${publicNote.sourceLinks}">
                            [
                            <a th:href="@{'/ff_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                            <span th:if="${sourceLink.name != null}">
                              <span th:text="${sourceLink.name}"></span>
                            </span>
                            <button type="button" class="btn badge badge-warning"
                                    th:data-id="${sourceLink.id}"
                                    data-op-code="ff_source_link"
                                    data-toggle="delete-confirm"
                                    data-placement="right"
                                    sec:authorize="${#vars.isDefinitionCrudGranted}">
                              <i class="fa fa-remove" aria-hidden="true"></i>
                            </button>
                            ]
                          </span>
                          <button type="button" class="btn badge badge-success"
                                  title="Lisa allikaviide"
                                  data-toggle="modal"
                                  th:data-target="${'#addDefinitionPublicNoteSourceLinkDlg_' + definition.id + '_' + publicNote.id}"
                                  sec:authorize="${#vars.isDefinitionCrudGranted}">
                            <i class="fa fa-external-link" aria-hidden="true"></i>
                          </button>
                        </div>
                      </th:block>
                    </div>
                  </div>
                </div>
              </th:block>
            </div>
          </div>
          <div class="row" th:if="${not #lists.isEmpty(meaning.learnerComments)}">
            <hr />
            <div class="col pr-0 col-w13rem">
              <span class="lbl">Õppekommentaarid
                <button type="button" class="btn badge badge-success"
                        title="Lisa uus"
                        data-toggle="modal"
                        th:data-target="${'#addLearnerCommentDlg_' + meaningId}"
                        sec:authorize="${#vars.isMeaningCrudGranted}">
                  <i class="fa fa-plus" aria-hidden="true"></i>
                </button>
              </span>
            </div>
            <div class="col pl-0">
              <th:block th:each="learnerComment : ${meaning.learnerComments}">
                <div th:replace="termdialog :: edit_learner_comment_dlg"></div>
                <div class="row">
                  <div class="col hidden-buttons">
                    <div class="action-buttons-anchor">
                      <span th:utext="${learnerComment.valuePrese}"></span>
                      <div class="action-buttons-2">
                        <button type="button" class="btn badge badge-primary"
                                title="Muuda"
                                data-toggle="modal"
                                th:data-target="${'#editLearnerCommentDlg_' + meaningId + '_' + learnerComment.id}"
                                sec:authorize="${#vars.isMeaningCrudGranted}">
                          <i class="fa fa-edit" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${learnerComment.id}"
                                data-op-code="learner_comment"
                                data-toggle="delete-confirm"
                                data-placement="right"
                                sec:authorize="${#vars.isMeaningCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </th:block>
            </div>
          </div>
          <div class="row" th:if="${not #lists.isEmpty(meaning.publicNotes)}">
            <hr />
            <div class="col pr-0 col-w13rem">
                  <span class="lbl">Märkused
                    <button type="button" class="btn badge badge-success"
                            title="Lisa uus"
                            data-toggle="modal"
                            th:data-target="${'#addMeaningPublicNoteDlg_' + meaningId}"
                            sec:authorize="${#vars.isMeaningCrudGranted}">
                      <i class="fa fa-plus" aria-hidden="true"></i>
                    </button>
                  </span>
            </div>
            <div th:if="${not #lists.isEmpty(meaning.publicNotes)}" class="col pl-0">
              <th:block th:each="publicNote : ${meaning.publicNotes}">
                <div th:replace="termdialog :: edit_meaning_public_note_dlg"></div>
                <div th:replace="termdialog :: add_meaning_public_note_source_link_dlg"></div>
                <div class="invisible-buttons action-buttons-anchor mw-90">
                  <div style="display: list-item; position: absolute"></div>
                  <span th:utext="${publicNote.valuePrese}"></span>
                  <span class="show-on-mouseover" th:if="${#lists.isEmpty(publicNote.sourceLinks)}">
                          [
                          <button type="button" class="btn badge badge-success"
                                  title="Lisa allikaviide"
                                  data-toggle="modal"
                                  th:data-target="${'#addMeaningPublicNoteSourceLinkDlg_' + meaningId + '_' + publicNote.id}"
                                  sec:authorize="${#vars.isMeaningCrudGranted}">
                            <i class="fa fa-external-link" aria-hidden="true"></i>
                          </button>
                          ]
                        </span>
                  <div class="action-buttons-2">
                    <button type="button" class="btn badge badge-primary"
                            th:title="Muuda"
                            data-toggle="modal"
                            th:data-target="${'#editMeaningPublicNoteDlg_' + meaningId + '_' + publicNote.id}"
                            sec:authorize="${#vars.isMeaningCrudGranted}">
                      <i class="fa fa-edit" aria-hidden="true"></i>
                    </button>
                    <button type="button" class="btn badge badge-warning"
                            th:data-id="${publicNote.id}"
                            data-op-code="meaning_public_note"
                            data-toggle="delete-confirm"
                            data-placement="right"
                            sec:authorize="${#vars.isMeaningCrudGranted}">
                      <i class="fa fa-remove" aria-hidden="true"></i>
                    </button>
                  </div>
                </div>
                <div class="hidden-buttons">
                      <span th:each="sourceLink : ${publicNote.sourceLinks}">
                        [
                        <a th:href="@{'/ff_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                        <span th:if="${sourceLink.name != null}">
                          <span th:text="${sourceLink.name}"></span>
                        </span>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${sourceLink.id}"
                                data-op-code="ff_source_link"
                                data-toggle="delete-confirm"
                                data-placement="right"
                                sec:authorize="${#vars.isMeaningCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                        ]
                      </span>
                  <button type="button" class="btn badge badge-success"
                          title="Lisa allikaviide"
                          data-toggle="modal"
                          th:data-target="${'#addMeaningPublicNoteSourceLinkDlg_' + meaningId + '_' + publicNote.id}"
                          sec:authorize="${#vars.isMeaningCrudGranted}">
                    <i class="fa fa-external-link" aria-hidden="true"></i>
                  </button>
                </div>
              </th:block>
            </div>
          </div>
          <div class="row" th:if="${not #lists.isEmpty(meaning.images)}">
            <hr>
            <div class="col pr-0 col-w13rem">
              <span class="lbl">Pildid</span>
            </div>
            <div class="col pl-0">
              <th:block th:each="image : ${meaning.images}">
                <div th:replace="termdialog :: add_image_title_dlg"></div>
                <div th:replace="termdialog :: edit_image_title_dlg"></div>
                <div th:replace="termdialog :: add_image_source_link_dlg"></div>
                <div class="invisible-buttons action-buttons-anchor w-100">
                  <img class="w-25" th:src="@{'/files/images/' + ${image.fileName}}">
                  <span th:if="${#strings.isEmpty(image.title)}">
                    <button type="button" class="btn badge badge-success align-bottom"
                            title="Lisa pealkiri"
                            data-toggle="modal"
                            th:data-target="${'#addImageTitleDlg_' + image.id}"
                            sec:authorize="${#vars.isMeaningCrudGranted}">
                      <i class="fa fa-plus" aria-hidden="true"></i>
                    </button>
                    <button type="button" class="btn badge badge-success align-bottom"
                            title="Lisa allikaviide"
                            data-toggle="modal"
                            th:data-target="${'#addImageSourceLinkDlg_' + image.id}"
                            sec:authorize="${#vars.isMeaningCrudGranted}">
                      <i class="fa fa-external-link" aria-hidden="true"></i>
                    </button>
                  </span>
                </div>
                <div class="col pl-0" th:if="${#strings.isEmpty(image.title)}">
                  <span th:each="sourceLink : ${image.sourceLinks}" class="hidden-buttons">
                    [
                      <a th:href="@{'/ff_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                      <span th:if="${sourceLink.name != null}">
                        <span th:text="${sourceLink.name}"></span>
                      </span>
                      <button type="button" class="btn badge badge-warning"
                              th:data-id="${sourceLink.id}"
                              data-op-code="ff_source_link"
                              data-toggle="delete-confirm"
                              data-placement="right"
                              sec:authorize="${#vars.isMeaningCrudGranted}">
                        <i class="fa fa-remove" aria-hidden="true"></i>
                      </button>
                      ]
                  </span>
                </div>
                <div th:unless="${#strings.isEmpty(image.title)}">
                  <div class="invisible-buttons action-buttons-anchor mw-90">
                    <span th:text="${image.title}"></span>
                    <span class="show-on-mouseover" th:if="${#lists.isEmpty(image.sourceLinks)}">
                      [
                      <button type="button" class="btn badge badge-success"
                              title="Lisa allikaviide"
                              data-toggle="modal"
                              th:data-target="${'#addImageSourceLinkDlg_' + image.id}"
                              sec:authorize="${#vars.isMeaningCrudGranted}">
                        <i class="fa fa-external-link" aria-hidden="true"></i>
                      </button>
                      ]
                    </span>
                    <div class="action-buttons-2">
                      <button type="button" class="btn badge badge-primary"
                              th:title="Muuda"
                              data-toggle="modal"
                              th:data-target="${'#editImageTitleDlg_' + image.id}"
                              sec:authorize="${#vars.isMeaningCrudGranted}">
                        <i class="fa fa-edit" aria-hidden="true"></i>
                      </button>
                      <button type="button" class="btn badge badge-warning"
                              th:data-id="${image.id}"
                              data-op-code="image_title"
                              data-toggle="delete-confirm"
                              data-placement="right"
                              sec:authorize="${#vars.isMeaningCrudGranted}">
                        <i class="fa fa-remove" aria-hidden="true"></i>
                      </button>
                    </div>
                  </div>
                  <div class="hidden-buttons">
                    <span th:each="sourceLink : ${image.sourceLinks}">
                      [
                      <a th:href="@{'/ff_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                      <span th:if="${sourceLink.name != null}">
                        <span th:text="${sourceLink.name}"></span>
                      </span>
                      <button type="button" class="btn badge badge-warning"
                              th:data-id="${sourceLink.id}"
                              data-op-code="ff_source_link"
                              data-toggle="delete-confirm"
                              data-placement="right"
                              sec:authorize="${#vars.isMeaningCrudGranted}">
                        <i class="fa fa-remove" aria-hidden="true"></i>
                      </button>
                      ]
                    </span>
                    <button type="button" class="btn badge badge-success"
                            title="Lisa allikaviide"
                            data-toggle="modal"
                            th:data-target="${'#addImageSourceLinkDlg_' + image.id}"
                            sec:authorize="${#vars.isMeaningCrudGranted}">
                      <i class="fa fa-external-link" aria-hidden="true"></i>
                    </button>
                  </div>
                  <hr>
                </div>
              </th:block>
            </div>
          </div>
          <div class="row" th:if="${not #lists.isEmpty(meaning.freeforms)}">
            <hr/>
            <div class="col pr-0 col-w13rem">
              <span class="lbl">Tähenduse atribuudid</span>
            </div>
            <div class="col pl-0">
              <table>
                <tr th:each="freeform : ${meaning.freeforms}">
                  <td style="vertical-align: text-top; padding-right: 1em">
                    <span th:text="${freeform.type}"></span>
                  </td>
                  <td>
                    <span th:utext="${freeform.valueText}" th:if="${freeform.valueText != null}"></span>
                    <span th:text="${#dates.format(freeform.valueDate, 'dd.MM.yyyy HH:mm')}" th:if="${freeform.valueDate != null}"></span>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="row" th:if="${not #lists.isEmpty(meaning.groupedRelations)}">
            <hr />
            <div class="col pr-0 col-w13rem">
              <span class="lbl">Tähenduse seosed</span>
              <button type="button" class="btn badge badge-success"
                      title="Lisa seos"
                      data-toggle="modal"
                      th:data-target="${'#addMeaningRelationDlg_' + meaningId}"
                      sec:authorize="${#vars.isMeaningCrudGranted}">
                <i class="fa fa-plus" aria-hidden="true"></i>
              </button>
            </div>
            <div class="col pl-0">
              <table th:if="${not #lists.isEmpty(meaning.groupedRelations)}">
                <tr th:each="relations : ${meaning.groupedRelations}" class="hidden-buttons">
                  <td class="pr-3">
                    <th:block th:each="relation, iter : ${relations}">
                      <button type="button" class="btn btn-link p-0" th:data-id="${relation.meaningId}" name="detailsBtn">
                        <span th:text="${relation.word + ' (' + iso2languages[relation.wordLang] + ')'}"></span>
                      </button>
                      <span th:unless="${iter.last}">,</span>
                    </th:block>
                  </td>
                  <td>
                    <span th:text="${relations.get(0).relationTypeLabel}"></span>
                    <button type="button" class="btn badge badge-warning"
                            data-placement="right"
                            th:data-id="${relations.get(0).id}"
                            data-op-code="meaning_relation"
                            data-toggle="delete-confirm"
                            sec:authorize="${#vars.isMeaningCrudGranted}">
                      <i class="fa fa-remove" aria-hidden="true"></i>
                    </button>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div id="meaningLifecycleLogDlg" class="modal" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body"></div>
              </div>
            </div>
          </div>
          <div id="processLogDlg" class="modal" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <th:block th:each="lexemeLangGroup : ${meaning.lexemeLangGroups}">
        <div class="ml-2 mt-2 mb-2">
          <span th:text="${iso2languages[lexemeLangGroup.lang]}" class="mr-2"></span>
          <button name="lang-collapse-btn" type="button" class="btn badge badge-secondary btn-toggle"
                  th:data-lang="${lexemeLangGroup.lang}"
                  th:title="${lexemeLangGroup.selected ? 'Peida keele grupp' : 'Näita keele gruppi'}">
            <i th:class="${lexemeLangGroup.selected ? 'fa fa-angle-down' : 'fa fa-angle-right'}" aria-hidden="true"></i>
          </button>
        </div>
        <div class="orderable" data-op-code="lexeme">
          <div th:each="lexeme,itemIter : ${lexemeLangGroup.lexemes}"
               th:if="${lexemeLangGroup.selected}"
               th:data-id="${lexeme.lexemeId}"
               th:data-orderby="${lexeme.orderBy}"
               class="card mb-2 shadow"
               th:with="
                  isLexemeCrudGranted=${#authorization.expression('hasPermission(#vars.lexeme.lexemeId, ''LEXEME'', ''DATASET:CRUD'')')},
                  isWordCrudGranted=${#authorization.expression('hasPermission(#vars.lexeme.wordId, ''WORD'', ''DATASET:CRUD'')')}
                  ">

            <div th:replace="termdialog :: add_lexeme_process_state_dlg"></div>
            <div th:replace="termdialog :: add_lexeme_data_dlg"></div>
            <div th:replace="termdialog :: add_lexeme_source_link_dlg"></div>
            <div th:replace="termdialog :: add_usage_dlg"></div>
            <div th:replace="termdialog :: add_lexeme_relation_dlg"></div>
            <div th:replace="termdialog :: add_lexeme_public_note_dlg"></div>
            <div th:replace="termdialog :: edit_lexeme_process_state_dlg"></div>
            <div th:replace="termdialog :: edit_lexeme_value_state_dlg"></div>
            <div th:replace="termdialog :: edit_lexeme_frequency_group_dlg"></div>
            <div th:replace="termdialog :: edit_word_value_dlg"></div>
            <div th:replace="termdialog :: edit_word_gender_dlg"></div>

            <div class="card-body" th:data-toggle-name="${'lexBody_' + lexeme.lexemeId}">
              <div class="d-flex flex-row align-items-center flex-wrap">
                <div class="d-flex align-items-center flex-wrap">
                  <div class="hidden-buttons">
                    <span th:id="${'word-value-' + lexeme.wordId}" th:utext="${lexeme.word}" class="ttl word-value"></span>
                    <button type="button" class="btn badge badge-primary"
                            title="Muuda"
                            data-toggle="modal"
                            th:data-target="${'#editWordValueDlg_' + lexeme.wordId}"
                            sec:authorize="${#vars.isWordCrudGranted}">
                      <i class="fa fa-edit" aria-hidden="true"></i>
                    </button>
                  </div>
                  <span th:text="${lexeme.homonymNumber}" class="pl-1"></span>
                  <span th:if="${lexeme.wordDisplayMorphCode != null}" th:text="${lexeme.wordDisplayMorphCode}" class="pl-1"></span>
                </div>
                <div class="ml-auto">
                  <button type="button" class="btn badge badge-success float-right"
                          title="Lisa andmeid"
                          data-toggle="modal"
                          th:data-target="${'#addLexemeDataDlg_' + lexeme.lexemeId}"
                          sec:authorize="${#vars.isLexemeCrudGranted}">
                    <i class="fa fa-plus" aria-hidden="true"></i>
                  </button>
                </div>
                <div class="ml-2">
                  <form th:action="@{/wordjoin}" method="get">
                    <input type="hidden" name="wordId" th:value="${lexeme.wordId}">
                    <input type="hidden" name="meaningId" th:value="${meaningId}">
                    <button type="submit" class="btn btn-sm btn-primary"
                            title="Ühenda keelendid"
                            sec:authorize="${#vars.isWordCrudGranted}"
                            th:if="${!lexeme.affixoid}">Ühenda</button>
                  </form>
                </div>
                <div class="ml-2">
                  <button type="button"
                          class="btn btn-warning font-weight-bold btn-sm"
                          th:data-id="${lexeme.lexemeId}"
                          data-op-code="lexeme"
                          data-toggle="delete-confirm"
                          sec:authorize="${#vars.isLexemeCrudGranted}">
                    Eemalda
                  </button>
                </div>
                <div class="ml-2">
                  <a th:href="@{'/lexemeandwordprocesslog:' + ${lexeme.lexemeId}}"
                     data-toggle="modal"
                     data-target="#processLogDlg"
                     class="btn btn-secondary btn-sm ml-4"
                     sec:authorize="${#vars.isLexemeCrudGranted}">Menetluse logi</a>
                </div>
                <div class="ml-2">
                  <b th:text="${lexeme.dataset}"></b>
                </div>
                <div class="ml-2">
                  <th:block th:replace="common :: ordering_buttons(${itemIter})" sec:authorize="${#vars.isMeaningCrudGranted}"></th:block>
                </div>
              </div>
              <div>
                <hr />
                <span th:unless="${lexeme.classifiersExist}">&nbsp;</span>
                <div th:replace="termcomp :: lexeme_complexity"></div>
                <div th:replace="termcomp :: lexeme_process_state"></div>
                <div th:replace="termcomp :: lexeme_value_state"></div>
                <div th:replace="termcomp :: word_gender"></div>
                <div th:replace="termcomp :: word_type"></div>
                <div th:replace="termcomp :: lexeme_frequency_group"></div>
                <div th:replace="termcomp :: lexeme_grammar"></div>
                <div th:replace="termcomp :: lexeme_pos"></div>
                <div th:replace="termcomp :: lexeme_derivative"></div>
                <div th:replace="termcomp :: lexeme_register"></div>
                <div th:replace="termcomp :: lexeme_region"></div>
              </div>
              <div class="row" th:if="${not #lists.isEmpty(lexeme.sourceLinks)}">
                <hr />
                <div class="col pr-0 col-w13rem">
                  <span class="lbl">Allikaviide</span>
                  <button type="button" class="btn badge badge-success"
                          title="Lisa allikaviide"
                          data-toggle="modal"
                          th:data-target="${'#addLexemeSourceLinkDlg_' + lexeme.lexemeId}"
                          sec:authorize="${#vars.isLexemeCrudGranted}">
                    <i class="fa fa-external-link" aria-hidden="true"></i>
                  </button>
                </div>
                <div class="col pl-0">
                  <span th:each="sourceLink : ${lexeme.sourceLinks}" class="hidden-buttons">
                    [
                    <a th:href="@{'/lex_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                    <span th:if="${sourceLink.name != null}">
                      <span th:text="${sourceLink.name}"></span>
                    </span>
                    <button type="button" class="btn badge badge-warning"
                            data-placement="right"
                            th:data-id="${sourceLink.id}"
                            data-op-code="lex_source_link"
                            data-toggle="delete-confirm"
                            sec:authorize="${#vars.isLexemeCrudGranted}">
                      <i class="fa fa-remove" aria-hidden="true"></i>
                    </button>
                    ]
                  </span>
                </div>
              </div>
              <div class="row" th:if="${not #lists.isEmpty(lexeme.usages)}">
                <hr />
                <div class="col pr-0 col-w13rem">
                  <span class="lbl">Kasutusnäited</span>
                  <button type="button" class="btn badge badge-success"
                          title="Lisa uus"
                          data-toggle="modal"
                          th:data-target="${'#addUsageDlg_' + lexeme.lexemeId}"
                          sec:authorize="${#vars.isLexemeCrudGranted}">
                    <i class="fa fa-plus" aria-hidden="true"></i>
                  </button>
                </div>
                <div th:if="${not #lists.isEmpty(lexeme.usages)}" class="col pl-0">
                  <div th:each="usage : ${lexeme.usages}"
                       th:with="isUsageCrudGranted=${#authorization.expression('hasPermission(#vars.usage.id, ''USAGE'', ''DATASET:CRUD'')')}">
                    <div th:replace="termdialog :: edit_usage_dlg"></div>
                    <div th:replace="termdialog :: add_usage_source_link_dlg"></div>
                    <div class="invisible-buttons action-buttons-anchor mw-90">
                      <div style="display: list-item; position: absolute"></div>
                      <span th:utext="${usage.value}"></span>
                      <span th:if="${usage.typeValue != null}" th:text="'(' + ${usage.typeValue + ')'}"></span>
                      <span th:if="${not #lists.isEmpty(usage.authors)}">
                        (
                        <span th:each="sourceLink,sourceLinkIter : ${usage.authors}">
                          <span th:text="#{'enum.reference.type.' + ${sourceLink.type}} + ': '"></span>
                          <a th:href="@{'/ff_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}" th:if="${sourceLink.value != null}"></a>
                          <span th:if="${sourceLink.name != null}">
                            <span th:text="${sourceLink.name}"></span>
                          </span>
                          <span th:unless="${sourceLinkIter.last}">, </span>
                        </span>
                        )
                      </span>
                      <span class="show-on-mouseover" th:if="${#lists.isEmpty(usage.sourceLinks)}">
                        [
                        <button type="button" class="btn badge badge-success"
                                title="Lisa allikaviide"
                                data-toggle="modal"
                                th:data-target="${'#addUsageSourceLinkDlg_' + usage.id}"
                                sec:authorize="${#vars.isUsageCrudGranted}">
                          <i class="fa fa-external-link" aria-hidden="true"></i>
                        </button>
                        ]
                      </span>
                      <div class="action-buttons-2">
                        <button type="button" class="btn badge badge-primary"
                                title="Muuda"
                                data-toggle="modal"
                                th:data-target="${'#editUsageDlg_' + lexeme.lexemeId + '_' + usage.id}"
                                sec:authorize="${#vars.isUsageCrudGranted}">
                          <i class="fa fa-edit" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${usage.id}"
                                data-op-code="usage"
                                data-toggle="delete-confirm"
                                data-placement="right"
                                sec:authorize="${#vars.isUsageCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                    <div class="hidden-buttons" th:if="${not #lists.isEmpty(usage.sourceLinks)}">
                      <span th:each="sourceLink : ${usage.sourceLinks}">
                        [
                        <a th:href="@{'/ff_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                        <span th:text="${sourceLink.name}" th:if="${sourceLink.name != null}"></span>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${sourceLink.id}"
                                data-op-code="ff_source_link"
                                data-toggle="delete-confirm" 
                                data-placement="right"
                                sec:authorize="${#vars.isUsageCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                        ]
                      </span>
                      <button type="button" class="btn badge badge-success"
                              title="Lisa allikaviide"
                              data-toggle="modal"
                              th:data-target="${'#addUsageSourceLinkDlg_' + usage.id}"
                              sec:authorize="${#vars.isUsageCrudGranted}">
                        <i class="fa fa-external-link" aria-hidden="true"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" th:if="${not #lists.isEmpty(lexeme.lexemeRelations)}">
                <hr />
                <div class="col pr-0 col-w13rem">
                  <span class="lbl">Ilmiku seosed</span>
                  <button type="button" class="btn badge badge-success"
                          title="Lisa seos"
                          data-toggle="modal"
                          th:data-target="${'#addLexemeRelationDlg_' + lexeme.lexemeId}"
                          sec:authorize="${#vars.isLexemeCrudGranted}">
                    <i class="fa fa-plus" aria-hidden="true"></i>
                  </button>
                </div>
                <div class="col pl-0">
                  <table class="orderable" th:data-op-code="lexeme_relation" th:if="${not #lists.isEmpty(lexeme.lexemeRelations)}">
                    <tr th:each="relation, itemIter : ${lexeme.lexemeRelations}" th:data-id="${relation.id}" th:data-orderby="${relation.orderBy}">
                      <td class="action-column">
                        <th:block th:replace="common :: ordering_buttons(${itemIter})" sec:authorize="${#vars.isLexemeCrudGranted}"></th:block>
                      </td>
                      <td class="pr-3 invisible-buttons">
                        <button type="button" class="btn btn-link btn-xs" th:data-id="${relation.meaningId}" name="detailsBtn">
                          <span th:text="${relation.word + ' (' + iso2languages[relation.wordLang] + ')'}"></span>
                        </button>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${relation.id}"
                                data-op-code="lexeme_relation"
                                data-toggle="delete-confirm"
                                data-placement="left"
                                sec:authorize="${#vars.isLexemeCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                      </td>
                      <td class="invisible-buttons">
                        <span th:text="${relation.relationTypeLabel}"></span>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
              <div class="row" th:if="${not #lists.isEmpty(lexeme.publicNotes)}">
                <hr />
                <div class="col pr-0 col-w13rem">
                  <span class="lbl">Märkused
                    <button type="button" class="btn badge badge-success"
                            title="Lisa uus"
                            data-toggle="modal"
                            th:data-target="${'#addLexemePublicNoteDlg_' + lexeme.lexemeId}"
                            sec:authorize="${#vars.isLexemeCrudGranted}">
                      <i class="fa fa-plus" aria-hidden="true"></i>
                    </button>
                  </span>
                </div>
                <div th:if="${not #lists.isEmpty(lexeme.publicNotes)}" class="col pl-0">
                  <th:block th:each="publicNote : ${lexeme.publicNotes}">
                    <div th:replace="termdialog :: edit_lexeme_public_note_dlg"></div>
                    <div th:replace="termdialog :: add_lexeme_public_note_source_link_dlg"></div>
                    <div class="invisible-buttons action-buttons-anchor mw-90">
                      <div style="display: list-item; position: absolute"></div>
                      <span th:utext="${publicNote.valuePrese}"></span>
                        <span class="show-on-mouseover" th:if="${#lists.isEmpty(publicNote.sourceLinks)}">
                          [
                          <button type="button" class="btn badge badge-success"
                                  title="Lisa allikaviide"
                                  data-toggle="modal"
                                  th:data-target="${'#addLexemePublicNoteSourceLinkDlg_' + lexeme.lexemeId + '_' + publicNote.id}"
                                  sec:authorize="${#vars.isLexemeCrudGranted}">
                            <i class="fa fa-external-link" aria-hidden="true"></i>
                          </button>
                          ]
                        </span>
                      <div class="action-buttons-2">
                        <button type="button" class="btn badge badge-primary"
                                th:title="Muuda"
                                data-toggle="modal"
                                th:data-target="${'#editLexemePublicNoteDlg_' + lexeme.lexemeId + '_' + publicNote.id}"
                                sec:authorize="${#vars.isLexemeCrudGranted}">
                          <i class="fa fa-edit" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${publicNote.id}"
                                data-op-code="lexeme_public_note"
                                data-toggle="delete-confirm"
                                data-placement="right"
                                sec:authorize="${#vars.isLexemeCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                    <div class="hidden-buttons">
                      <span th:each="sourceLink : ${publicNote.sourceLinks}">
                        [
                        <a th:href="@{'/ff_source_link:' + ${sourceLink.id}}" th:text="${sourceLink.value}"></a>
                        <span th:if="${sourceLink.name != null}">
                          <span th:text="${sourceLink.name}"></span>
                        </span>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${sourceLink.id}"
                                data-op-code="ff_source_link"
                                data-toggle="delete-confirm" 
                                data-placement="right"
                                sec:authorize="${#vars.isLexemeCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                        ]
                      </span>
                      <button type="button" class="btn badge badge-success"
                              title="Lisa allikaviide"
                              data-toggle="modal"
                              th:data-target="${'#addLexemePublicNoteSourceLinkDlg_' + lexeme.lexemeId + '_' + publicNote.id}"
                              sec:authorize="${#vars.isLexemeCrudGranted}">
                        <i class="fa fa-external-link" aria-hidden="true"></i>
                      </button>
                    </div>
                  </th:block>
                </div>
              </div>
              <div th:if="${not #lists.isEmpty(lexeme.freeforms)}" class="row">
                <hr />
                <div class="col pr-0 col-w13rem">
                  <span class="lbl">Ilmiku atribuudid</span>
                </div>
                <div class="col pl-0">
                  <table>
                    <tr th:each="freeform : ${lexeme.freeforms}">
                      <td style="vertical-align: text-top; padding-right: 1em">
                        <span th:text="${freeform.type}"></span>
                      </td>
                      <td>
                        <span th:utext="${freeform.valueText}" th:if="${freeform.valueText != null}"></span>
                        <span th:text="${#dates.format(freeform.valueDate, 'dd.MM.yyyy HH:mm')}" th:if="${freeform.valueDate != null}"></span>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </th:block>
    </div>
    <script th:replace="common :: confirmations"></script>
    <script>
		$('[data-toggle=deleteMeaningAndLexemesAndWords]').confirmation({
			btnOkLabel: 'Jah',
			btnCancelLabel: 'Ei',
			title: 'Kinnita kustutamine',
			onConfirm: deleteMeaningAndLexemesAndWords
		});
    </script>
  </th:block>

  <div th:replace="common :: newWordDlg('term_search')"></div>
  <div th:replace="common :: #sourceDetailsDlg"></div>
  <div th:replace="common :: #alertDlg"></div>
  <div th:replace="common :: #confirmDlg"></div>
  <div th:replace="common :: #waitDlg"></div>
  <div th:replace="sourcedialog :: add_source_dlg('term_search')"></div>

  <script th:inline="javascript">
  	initialise();
  </script>
</body>
</html>
